<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Wing Chan">

<title>Mini-Project #03: Visualizing and Maintaining the Green Canopy of NYC ‚Äì STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-775e219e353c32b256e2f40f182345c5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project #03: Visualizing and Maintaining the Green Canopy of NYC</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Wing Chan </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="data-acquisition" class="level1">
<h1>Data Acquisition</h1>
<p>NYC City Council Districts Task 1: Download NYC Citcy Council District Boundaries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data/mp03 under working folder if it doesnt exsit </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>))){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#download zip file  -- City Council (Clipped to Shoreline) Most Recent Release</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#https://s-media.nyc.gov/agencies/dcp/assets/files/zip/data-tools/bytes/city-council/nycc_25c.zip</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>current_url <span class="ot">&lt;-</span> <span class="st">"https://s-media.nyc.gov/agencies/dcp/assets/files/zip/data-tools/bytes/city-council/nycc_25c.zip"</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>destfile <span class="ot">&lt;-</span> <span class="st">"data/mp03/nycd_23c.zip"</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(destfile)) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> destfile, <span class="at">mode =</span> <span class="st">"wb"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"File downloaded successfully to: "</span>, destfile)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"File already exists at: "</span>, destfile)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>File already exists at: data/mp03/nycd_23c.zip</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#unzip the downloaded file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> destfile, <span class="at">exdir=</span> <span class="st">"data/mp03"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Read the shp file in the unzipped directory using sf::st_read.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>shp_file <span class="ot">=</span> <span class="st">"data/mp03/nycc_25c/nycc.shp"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nyc_councildistricts <span class="ot">&lt;-</span> <span class="fu">st_read</span>(shp_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `nycc' from data source 
  `/Users/wingchan/STA9750-2025-FALL/data/mp03/nycc_25c/nycc.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 51 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 913175.1 ymin: 120128.4 xmax: 1067383 ymax: 272844.3
Projected CRS: NAD83 / New York Long Island (ftUS)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Transform the result</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>nyc_councildistricts <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(nyc_councildistricts, <span class="at">crs=</span><span class="st">"WGS84"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>nyc_councildistricts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 51 features and 3 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -74.25559 ymin: 40.49613 xmax: -73.70001 ymax: 40.91553
Geodetic CRS:  WGS 84
First 10 features:
   CounDist Shape_Leng Shape_Area                       geometry
1        42  220755.07  201334162 MULTIPOLYGON (((-73.86327 4...
2        45   56967.63  117904762 MULTIPOLYGON (((-73.92285 4...
3        20   61223.01  144833269 MULTIPOLYGON (((-73.77588 4...
4        21   87223.84  130912211 MULTIPOLYGON (((-73.86923 4...
5        22  100202.30  150395658 MULTIPOLYGON (((-73.88516 4...
6        19  185199.11  334738191 MULTIPOLYGON (((-73.74461 4...
7        30   75010.43  168734193 MULTIPOLYGON (((-73.8685 40...
8        29   61867.75  127849354 MULTIPOLYGON (((-73.81423 4...
9        51  208078.35  657989092 MULTIPOLYGON (((-74.11338 4...
10       23   84551.73  311520682 MULTIPOLYGON (((-73.72966 4...</code></pre>
</div>
</div>
</section>
<section id="nyc-tree-points" class="level1">
<h1>NYC Tree Points</h1>
</section>
<section id="task-2-download-tree-points" class="level1">
<h1>Task 2: Download Tree Points</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Setup ---</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data/mp03/batches"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>combined_file <span class="ot">&lt;-</span> <span class="st">"data/mp03/treepoints_all.gpkg"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Check if combined file already exists ---</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(combined_file)) {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"‚úÖ Combined dataset already exists at"</span>, combined_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  ENDPOINT <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/resource/hn5i-inap.geojson"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  BATCH_SIZE <span class="ot">&lt;-</span> <span class="dv">30000</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Detect last completed batch ---</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  existing_batches <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data/mp03/batches"</span>, <span class="at">pattern =</span> <span class="st">"tree_batch_</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.geojson$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(existing_batches) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    last_batch <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, <span class="fu">basename</span>(existing_batches))))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    OFFSET <span class="ot">&lt;-</span> last_batch <span class="sc">*</span> BATCH_SIZE</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    BATCH <span class="ot">&lt;-</span> last_batch <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"üîÑ Resuming download from batch"</span>, BATCH, <span class="st">"offset"</span>, OFFSET, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    OFFSET <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    BATCH <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"üöÄ Starting fresh download</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  END_OF_EXPORT <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Download loop ---</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="sc">!</span>END_OF_EXPORT) {</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üì¶ Downloading batch"</span>, BATCH, <span class="st">"offset"</span>, OFFSET, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure OFFSET is plain integer to avoid scientific notation</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    offset_plain <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(OFFSET)</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(ENDPOINT, <span class="st">"?$limit="</span>, BATCH_SIZE, <span class="st">"&amp;$offset="</span>, offset_plain)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"üîó API Request URL:"</span>, url, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Retry logic (up to 3 attempts)</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    success <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    tries <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="sc">!</span>success <span class="sc">&amp;&amp;</span> tries <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>      tries <span class="ot">&lt;-</span> tries <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"üîÅ Attempt"</span>, tries, <span class="st">"for batch"</span>, BATCH, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>      resp <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">request</span>(url) <span class="sc">|&gt;</span> <span class="fu">req_perform</span>()</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="st">"‚ö†Ô∏è Attempt "</span>, tries, <span class="st">" failed: "</span>, e<span class="sc">$</span>message)</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(resp)) success <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>success) {</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"‚ùå Failed after 3 attempts, stopping at batch "</span>, BATCH)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save batch locally</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    batch_file <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"data/mp03/batches/tree_batch_%03d.geojson"</span>, BATCH)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip if file already exists</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.exists</span>(batch_file)) {</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"‚ö†Ô∏è Batch file already exists, skipping:"</span>, batch_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">writeBin</span>(<span class="fu">resp_body_raw</span>(resp), batch_file)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"üíæ Saved batch to"</span>, batch_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Stop if small file (probably end of dataset)</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.size</span>(batch_file) <span class="sc">&lt;</span> <span class="dv">10000</span>) {</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"‚úÖ End of export reached (small file size)."</span>)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlink</span>(batch_file)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>      END_OF_EXPORT <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    OFFSET <span class="ot">&lt;-</span> OFFSET <span class="sc">+</span> BATCH_SIZE</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    BATCH <span class="ot">&lt;-</span> BATCH <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Sys.sleep</span>(<span class="dv">2</span>)  <span class="co"># polite pause to avoid rate limit</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">üéâ Download complete. Files saved in data/mp03/batches</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Combined dataset already exists at data/mp03/treepoints_all.gpkg </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>combined_file <span class="ot">&lt;-</span> <span class="st">"data/mp03/treepoints_all.gpkg"</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Check if combined file already exists ---</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(combined_file)) {</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"‚úÖ Combined dataset already exists at"</span>, combined_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  treepoints_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(combined_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List all batch files</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  batch_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">"data/mp03/batches"</span>, <span class="at">pattern =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.geojson$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"üìÇ Found"</span>, <span class="fu">length</span>(batch_files), <span class="st">"files to read.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read each file into sf object</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  all_batches <span class="ot">&lt;-</span> <span class="fu">lapply</span>(batch_files, <span class="cf">function</span>(f) {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Reading"</span>, f, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>(<span class="fu">st_read</span>(f, <span class="at">quiet =</span> <span class="cn">TRUE</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all batches</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  treepoints_sf <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_batches)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save combined file</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_write</span>(treepoints_sf, combined_file, <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"‚úÖ Combined dataset with"</span>, <span class="fu">nrow</span>(treepoints_sf), <span class="st">"records saved to"</span>, combined_file, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>‚úÖ Combined dataset already exists at data/mp03/treepoints_all.gpkg </code></pre>
</div>
</div>
</section>
<section id="data-integration-and-initial-exploration" class="level1">
<h1>Data Integration and Initial Exploration</h1>
<p>Task 3: Plot All Tree Points</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Base map with NYC council districts (polygon layer)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Council district boundaries</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> nyc_councildistricts,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"grey95"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.4</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Trees (point layer)</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> treepoints_sf,        <span class="co"># or treepoints_sf</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"#80B40A"</span>,               <span class="co"># green</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span>,                     <span class="co"># transparency to reduce overplotting</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.1</span>                      <span class="co"># small points for legibility</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titles and labels</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"NYC Street Trees by Council District"</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Styling</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>  )  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get tree sample</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>treepoints_sample <span class="ot">&lt;-</span> treepoints_sf <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100000</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#check sample data</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(treepoints_sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 13 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -74.14782 ymin: 40.564 xmax: -73.82123 ymax: 40.83363
Geodetic CRS:  WGS 84
  tpcondition stumpdiameter      riskratingdate riskrating objectid
1        Good             0                &lt;NA&gt;       &lt;NA&gt;  2150908
2        Fair          &lt;NA&gt; 2024-09-05 16:41:29          7  4633657
3        Good          &lt;NA&gt; 2024-07-29 19:19:22          3 10676543
4        Dead            25                &lt;NA&gt;       &lt;NA&gt;  4801682
5        Fair          &lt;NA&gt; 2025-10-02 14:43:58          6  3980872
6        Good          &lt;NA&gt; 2024-12-24 13:36:19          6  4001963
                              globalid tpstructure
1 0CC88719-8060-4BFA-8EC1-EF3EB512DAC9     Retired
2 13509379-601D-4472-8CEE-503B784233FF        Full
3 BED2D679-7D3A-4FB7-A92E-39EB31EAE2CF        Full
4 3D48AD8D-85C3-452E-9117-2EAD08BBAD8D     Retired
5 1266C957-6914-4A02-832D-F6FCFCF6FFC2        Full
6 6638DBDA-6427-4C2E-9544-751A4EE415F3        Full
                 plantingspaceglobalid         createddate dbh planteddate
1 20F481F8-1EA5-4F34-84C3-6BDF4BF695A7 2016-01-05 20:37:00  12        &lt;NA&gt;
2 96D99E3A-85B2-47D8-8990-4D1CA0B24C01 2016-11-02 16:59:52  14        &lt;NA&gt;
3 32E077DF-3F08-401E-83FA-68D55007A236 2020-06-01 19:46:00   9        &lt;NA&gt;
4 E33B24CF-59C3-4DE3-9E50-F8E8F0DB0C1C 2017-01-05 11:01:00   0        &lt;NA&gt;
5 9734501C-9899-489B-B2FB-B43902A0C3AA 2016-07-28 12:29:08   8        &lt;NA&gt;
6 1F1C5501-DDCB-4871-8141-9F563D44FBBF 2016-07-27 14:19:57   8        &lt;NA&gt;
          updateddate
1 2019-11-06 15:02:00
2 2024-09-05 16:41:29
3 2024-07-29 19:19:22
4 2017-03-14 15:31:00
5 2025-10-02 14:43:58
6 2024-12-24 13:36:19
                                                genusspecies
1                            Ginkgo biloba - maidenhair tree
2 Gleditsia triacanthos var. inermis - Thornless honeylocust
3 Gleditsia triacanthos var. inermis - Thornless honeylocust
4                                          Unknown - Unknown
5                                Quercus palustris - pin oak
6                                    Acer rubrum - red maple
                        geom
1 POINT (-73.99316 40.72543)
2 POINT (-73.82123 40.72916)
3 POINT (-73.97664 40.60126)
4 POINT (-73.86246 40.83363)
5   POINT (-74.14782 40.564)
6 POINT (-74.03595 40.62866)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(treepoints_sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> tpcondition        stumpdiameter      riskratingdate               
 Length:100000      Length:100000      Min.   :2015-10-27 04:00:00  
 Class :character   Class :character   1st Qu.:2021-01-08 14:28:52  
 Mode  :character   Mode  :character   Median :2023-03-22 15:59:18  
                                       Mean   :2022-09-06 18:47:32  
                                       3rd Qu.:2024-09-12 16:10:44  
                                       Max.   :2025-10-29 20:03:04  
                                       NA's   :44264                
  riskrating          objectid           globalid         tpstructure       
 Length:100000      Length:100000      Length:100000      Length:100000     
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 plantingspaceglobalid  createddate                      dbh           
 Length:100000         Min.   :2015-02-28 05:00:00   Length:100000     
 Class :character      1st Qu.:2016-01-05 18:32:27   Class :character  
 Mode  :character      Median :2016-07-27 12:49:48   Mode  :character  
                       Mean   :2017-08-08 03:59:27                     
                       3rd Qu.:2018-02-19 11:27:14                     
                       Max.   :2025-10-29 19:48:00                     
                                                                       
  planteddate                   updateddate                  genusspecies      
 Min.   :2015-09-25 00:00:00   Min.   :2015-04-17 11:58:00   Length:100000     
 1st Qu.:2019-06-12 08:18:20   1st Qu.:2019-03-14 12:43:44   Class :character  
 Median :2022-05-27 04:00:00   Median :2022-03-14 16:14:42   Mode  :character  
 Mean   :2021-10-26 19:51:10   Mean   :2021-11-18 05:28:29                     
 3rd Qu.:2024-04-15 04:00:00   3rd Qu.:2024-07-15 17:36:39                     
 Max.   :2025-10-28 04:00:00   Max.   :2025-10-29 20:03:04                     
 NA's   :89186                 NA's   :19215                                   
            geom       
 POINT        :100000  
 epsg:4326    :     0  
 +proj=long...:     0  
                       
                       
                       
                       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#transform</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>treepoints_sample <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(treepoints_sample, <span class="fu">st_crs</span>(nyc_councildistricts))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#spatial join</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>districts_trees_contain_s <span class="ot">&lt;-</span> <span class="fu">st_join</span>(nyc_councildistricts, treepoints_sample, <span class="at">join =</span> st_contains)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#check sample </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(districts_trees_contain_s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    CounDist       Shape_Leng       Shape_Area        tpcondition       
 Min.   : 1.00   Min.   : 39108   Min.   : 37752246   Length:99956      
 1st Qu.:18.00   1st Qu.: 61868   1st Qu.:105180459   Class :character  
 Median :28.00   Median : 85923   Median :151771974   Mode  :character  
 Mean   :28.95   Mean   :130625   Mean   :235953679                     
 3rd Qu.:42.00   3rd Qu.:185199   3rd Qu.:328361699                     
 Max.   :51.00   Max.   :367887   Max.   :665196534                     
                                                                        
 stumpdiameter      riskratingdate                 riskrating       
 Length:99956       Min.   :2015-10-27 04:00:00   Length:99956      
 Class :character   1st Qu.:2021-01-08 14:41:48   Class :character  
 Mode  :character   Median :2023-03-22 16:13:33   Mode  :character  
                    Mean   :2022-09-06 20:03:04                     
                    3rd Qu.:2024-09-12 16:18:36                     
                    Max.   :2025-10-29 20:03:04                     
                    NA's   :44223                                   
   objectid           globalid         tpstructure        plantingspaceglobalid
 Length:99956       Length:99956       Length:99956       Length:99956         
 Class :character   Class :character   Class :character   Class :character     
 Mode  :character   Mode  :character   Mode  :character   Mode  :character     
                                                                               
                                                                               
                                                                               
                                                                               
  createddate                      dbh             planteddate                 
 Min.   :2015-02-28 05:00:00   Length:99956       Min.   :2015-09-25 00:00:00  
 1st Qu.:2016-01-05 18:32:10   Class :character   1st Qu.:2019-06-12 08:18:20  
 Median :2016-07-27 12:50:33   Mode  :character   Median :2022-05-27 04:00:00  
 Mean   :2017-08-08 07:46:17                      Mean   :2021-10-27 00:17:04  
 3rd Qu.:2018-02-20 09:00:29                      3rd Qu.:2024-04-15 04:00:00  
 Max.   :2025-10-29 19:48:00                      Max.   :2025-10-28 04:00:00  
                                                  NA's   :89143                
  updateddate                  genusspecies                geometry    
 Min.   :2015-04-17 11:58:00   Length:99956       MULTIPOLYGON :99956  
 1st Qu.:2019-03-14 13:42:08   Class :character   epsg:4326    :    0  
 Median :2022-03-14 17:13:03   Mode  :character   +proj=long...:    0  
 Mean   :2021-11-18 08:54:39                                           
 3rd Qu.:2024-07-15 18:07:28                                           
 Max.   :2025-10-29 20:03:04                                           
 NA's   :19182                                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#--- Full set of data ---#</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>treepoints_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(treepoints_sf, <span class="fu">st_crs</span>(nyc_councildistricts))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(treepoints_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> tpcondition        stumpdiameter      riskratingdate               
 Length:1093439     Length:1093439     Min.   :2015-03-26 10:46:35  
 Class :character   Class :character   1st Qu.:2020-12-23 20:00:17  
 Mode  :character   Mode  :character   Median :2023-03-22 15:12:43  
                                       Mean   :2022-09-03 04:43:49  
                                       3rd Qu.:2024-09-11 18:44:25  
                                       Max.   :2025-10-29 20:03:04  
                                       NA's   :482913               
  riskrating          objectid           globalid         tpstructure       
 Length:1093439     Length:1093439     Length:1093439     Length:1093439    
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
                                                                            
 plantingspaceglobalid  createddate                      dbh           
 Length:1093439        Min.   :2015-02-28 05:00:00   Length:1093439    
 Class :character      1st Qu.:2016-01-05 18:27:20   Class :character  
 Mode  :character      Median :2016-07-27 08:19:39   Mode  :character  
                       Mean   :2017-08-06 13:48:21                     
                       3rd Qu.:2018-02-20 08:55:01                     
                       Max.   :2025-10-29 20:03:00                     
                                                                       
  planteddate                   updateddate                  genusspecies      
 Min.   :0202-12-25 04:56:01   Min.   :2015-03-11 04:00:00   Length:1093439    
 1st Qu.:2019-06-18 16:00:00   1st Qu.:2019-03-11 14:19:36   Class :character  
 Median :2022-05-24 04:00:00   Median :2022-03-11 15:06:05   Mode  :character  
 Mean   :2021-09-24 15:49:18   Mean   :2021-11-15 03:15:04                     
 3rd Qu.:2024-01-29 05:00:00   3rd Qu.:2024-07-13 14:02:46                     
 Max.   :2108-11-23 05:00:00   Max.   :2025-10-29 20:49:00                     
 NA's   :975416                NA's   :210118                                  
            geom        
 POINT        :1093439  
 epsg:4326    :      0  
 +proj=long...:      0  
                        
                        
                        
                        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#spatial join</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>districts_trees <span class="ot">&lt;-</span> <span class="fu">st_join</span>(nyc_councildistricts, treepoints_sf, <span class="at">join =</span> st_contains)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#check sample </span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(districts_trees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    CounDist       Shape_Leng       Shape_Area        tpcondition       
 Min.   : 1.00   Min.   : 39108   Min.   : 37752246   Length:1092875    
 1st Qu.:18.00   1st Qu.: 61868   1st Qu.:105180459   Class :character  
 Median :28.00   Median : 85549   Median :151771974   Mode  :character  
 Mean   :28.95   Mean   :130435   Mean   :235006314                     
 3rd Qu.:42.00   3rd Qu.:185199   3rd Qu.:328361699                     
 Max.   :51.00   Max.   :367887   Max.   :665196534                     
                                                                        
 stumpdiameter      riskratingdate                 riskrating       
 Length:1092875     Min.   :2015-03-26 10:46:35   Length:1092875    
 Class :character   1st Qu.:2020-12-23 20:24:51   Class :character  
 Mode  :character   Median :2023-03-22 15:14:15   Mode  :character  
                    Mean   :2022-09-03 04:55:37                     
                    3rd Qu.:2024-09-11 18:46:21                     
                    Max.   :2025-10-29 20:03:04                     
                    NA's   :482361                                  
   objectid           globalid         tpstructure        plantingspaceglobalid
 Length:1092875     Length:1092875     Length:1092875     Length:1092875       
 Class :character   Class :character   Class :character   Class :character     
 Mode  :character   Mode  :character   Mode  :character   Mode  :character     
                                                                               
                                                                               
                                                                               
                                                                               
  createddate                      dbh             planteddate                 
 Min.   :2015-02-28 05:00:00   Length:1092875     Min.   :0202-12-25 04:56:01  
 1st Qu.:2016-01-05 18:27:00   Class :character   1st Qu.:2019-06-19 04:00:00  
 Median :2016-07-27 09:34:43   Mode  :character   Median :2022-05-24 04:00:00  
 Mean   :2017-08-06 18:11:48                      Mean   :2021-09-24 16:13:16  
 3rd Qu.:2018-02-20 12:09:03                      3rd Qu.:2024-01-29 05:00:00  
 Max.   :2025-10-29 20:03:00                      Max.   :2108-11-23 05:00:00  
                                                  NA's   :974853               
  updateddate                  genusspecies                geometry      
 Min.   :2015-03-11 04:00:00   Length:1092875     MULTIPOLYGON :1092875  
 1st Qu.:2019-03-11 14:33:45   Class :character   epsg:4326    :      0  
 Median :2022-03-11 15:47:11   Mode  :character   +proj=long...:      0  
 Mean   :2021-11-15 05:24:27                                             
 3rd Qu.:2024-07-13 14:28:32                                             
 Max.   :2025-10-29 20:49:00                                             
 NA's   :209643                                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --- Q1--- ##</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>district_tree_counts <span class="ot">&lt;-</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  districts_trees <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co"># Drop geometry for easy counting</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CounDist) <span class="sc">|&gt;</span> <span class="co"># adjust column name as needed</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tree_count =</span> <span class="fu">n</span>())</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>Most_tree_district <span class="ot">&lt;-</span> district_tree_counts <span class="sc">|&gt;</span> </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by=</span>tree_count , <span class="at">n=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-4-district-level-analysis-of-tree-coverage" class="level1">
<h1>Task 4: District-Level Analysis of Tree Coverage</h1>
<ol type="1">
<li>Which council district has the most trees?</li>
</ol>
<p>District 51 has most trees. There are 70927 in the district.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>tree_density <span class="ot">&lt;-</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>districts_trees <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co"># Drop geometry for easy counting</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CounDist, Shape_Area) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tree_count =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tree_density =</span> (tree_count<span class="sc">/</span>Shape_Area)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'CounDist'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Highest_tree_density <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  tree_density <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by=</span> tree_density, <span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>Highest_tree_density</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 4
  CounDist Shape_Area tree_count tree_density
     &lt;int&gt;      &lt;dbl&gt;      &lt;int&gt;        &lt;dbl&gt;
1        7  55186140.      15537       0.0282</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Which council district has the highest density of trees? The Shape_Area column from the district shape file will be helpful here.</li>
</ol>
<p>District 7 has highest density of trees of 0.0281538%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q3</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>Top_dead_tree_district <span class="ot">&lt;-</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>districts_trees <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co"># Drop geometry for easy counting</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CounDist) <span class="sc">|&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_trees =</span> <span class="fu">n</span>(),                        <span class="co"># (1) Total trees per district</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_dead_trees =</span> <span class="fu">sum</span>(tpcondition <span class="sc">==</span> <span class="st">"Dead"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># (2) Dead trees</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">percent_dead_trees =</span> (total_dead_trees <span class="sc">/</span> total_trees) <span class="sc">*</span> <span class="dv">100</span>   <span class="co"># (3) Percentage</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by=</span>percent_dead_trees, <span class="at">n=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Which district has highest fraction of dead trees out of all trees?</li>
</ol>
<p>District 32 has highest fraction of dead trees of 14.2229272% .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q4</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>tree_species_manhattan <span class="ot">&lt;-</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  districts_trees <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add borough column based on CounDist</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">borough =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      CounDist <span class="sc">&gt;=</span> <span class="dv">1</span>  <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Manhattan"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>      CounDist <span class="sc">&gt;=</span> <span class="dv">11</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">18</span> <span class="sc">~</span> <span class="st">"Bronx"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>      CounDist <span class="sc">&gt;=</span> <span class="dv">19</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">32</span> <span class="sc">~</span> <span class="st">"Queens"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>      CounDist <span class="sc">&gt;=</span> <span class="dv">33</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">48</span> <span class="sc">~</span> <span class="st">"Brooklyn"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>      CounDist <span class="sc">&gt;=</span> <span class="dv">49</span> <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">51</span> <span class="sc">~</span> <span class="st">"Staten Island"</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span>            <span class="co"># handle unexpected values</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Filter for Manhattan only</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(borough <span class="sc">==</span> <span class="st">"Manhattan"</span>)<span class="sc">|&gt;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop geometry for easy counting</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Count number of trees by species</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(genusspecies) <span class="sc">|&gt;</span> </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tree_count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>Top_tree_species_manhattan <span class="ot">&lt;-</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  tree_species_manhattan <span class="sc">|&gt;</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> tree_count, <span class="at">n=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>What is the most common tree species in Manhattan?</li>
</ol>
<p>The most common tree speies in Manhattan is Gleditsia triacanthos var. inermis - Thornless honeylocust. There are 17311 Gleditsia triacanthos var. inermis - Thornless honeylocust in Manhattan.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Q5</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#spatial join using st_intersects</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>trees_districts <span class="ot">&lt;-</span> <span class="fu">st_join</span>(treepoints_sf, nyc_councildistricts, <span class="at">join =</span> st_intersects)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>new_st_point <span class="ot">&lt;-</span> <span class="cf">function</span>(lat, lon, ...){</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(lon, lat)), ...) <span class="sc">|&gt;</span>  </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="st">"WGS84"</span>)                  </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Lat lon for Baruch College</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>baruch_college <span class="ot">&lt;-</span> <span class="fu">new_st_point</span>(<span class="fl">40.740159</span>, <span class="sc">-</span><span class="fl">73.98338</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>baruch_college</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Geometry set for 1 feature 
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -73.98338 ymin: 40.74016 xmax: -73.98338 ymax: 40.74016
Geodetic CRS:  WGS 84</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>POINT (-73.98338 40.74016)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#transform to align </span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>trees_districts <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(trees_districts, <span class="fu">st_crs</span>(baruch_college))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>trees_districts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1093439 features and 16 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -74.25499 ymin: 40.49668 xmax: -73.69808 ymax: 40.91419
Geodetic CRS:  WGS 84
First 10 features:
   tpcondition stumpdiameter      riskratingdate riskrating objectid
1    Excellent          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    86823
2         Good          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    87623
3         Poor          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88023
4         Fair          &lt;NA&gt; 2024-06-28 12:41:55          6    88823
5         Dead          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88824
6         Fair          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    88825
7     Critical          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89223
8         Dead          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89225
9      Unknown          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89625
10        Fair          &lt;NA&gt;                &lt;NA&gt;       &lt;NA&gt;    89626
                               globalid tpstructure
1  2B457A4C-E0E4-4E17-81C4-A5449F51C804        Full
2  37195E1A-A7EE-4AA4-8389-19A0ED5C46F7     Retired
3  6BA8E72B-1901-4EF3-ABFF-D11680AB4A9B     Retired
4  79A5DBAF-F305-4DA1-A4B1-7A8C8D085435        Full
5  182F6647-D9C1-4A45-ADA0-9ADEFD1ECC60     Retired
6  394AEC59-B91C-45AD-93FB-2996B0C09747     Retired
7  8717EC83-F165-495A-A1AA-1064173A681F     Retired
8  FD617E56-130C-4E43-A76D-3AF989E37A2F     Retired
9  380AB840-F0E9-4B14-A4D6-A99B8861065E     Retired
10 8A487A6B-146A-4DE4-9AEE-835492B1E348     Retired
                  plantingspaceglobalid         createddate dbh planteddate
1  E814CD37-9F53-4D79-AF86-3B454F9D29B9 2015-02-28 05:00:00  20        &lt;NA&gt;
2  A644AB79-A3CB-4F7F-923B-F308E615CCD4 2015-03-03 05:00:00  10        &lt;NA&gt;
3  21431016-EDB8-4A0B-B122-673125800C87 2015-03-03 05:00:00  24        &lt;NA&gt;
4  96FB6C55-612F-466D-9449-85A3CD2178E1 2015-03-04 05:00:00  10        &lt;NA&gt;
5  4796B64F-906C-4345-A4E9-5CD6133642F8 2015-03-04 05:00:00  10        &lt;NA&gt;
6  F31930BA-47FD-4D9F-B8A2-7A4FA4707D16 2015-03-04 05:00:00  19        &lt;NA&gt;
7  ED1D6BF0-C0E7-49BB-9A1A-85CBF8558ACD 2015-03-04 05:00:00  12        &lt;NA&gt;
8  6AC474F7-0D16-43EC-A1F9-8C9B6C14F434 2015-03-04 05:00:00   8        &lt;NA&gt;
9  8E628B41-0A1D-4948-AAE3-F0B3A2A8AFE8 2015-03-04 05:00:00   6        &lt;NA&gt;
10 C6526419-CD64-4D8D-9288-C7967124B9B4 2015-03-04 05:00:00  15        &lt;NA&gt;
           updateddate
1  2016-10-20 17:43:53
2  2019-09-18 13:12:55
3  2018-03-27 14:00:42
4  2024-06-28 12:41:55
5  2016-10-24 02:50:43
6  2017-04-12 09:35:50
7  2020-01-08 16:27:00
8  2017-09-11 08:51:17
9  2016-12-28 12:18:15
10 2023-12-11 18:01:07
                                                 genusspecies CounDist
1                                   Acer nigrum - black maple       24
2                          Fraxinus pennsylvanica - Green ash        9
3                             Acer platanoides - Norway maple       12
4                             Pyrus calleryana - Callery pear       51
5  Gleditsia triacanthos var. inermis - Thornless honeylocust        2
6                              Fraxinus americana - white ash       23
7                          Zelkova serrata - Japanese zelkova        7
8                             Acer platanoides - Norway maple       49
9                           Tilia cordata - littleleaf linden        7
10                                    Abies alba - silver fir       32
   Shape_Leng Shape_Area                       geom
1    76779.51  186824791 POINT (-73.81657 40.71629)
2    41266.13   56263769 POINT (-73.93848 40.81299)
3    58158.18  131040796 POINT (-73.83244 40.88763)
4   208078.35  657989092 POINT (-74.20904 40.51958)
5    41619.72   48322121 POINT (-73.98032 40.74291)
6    84551.73  311520682  POINT (-73.73589 40.7359)
7    52375.10   55186140 POINT (-73.96597 40.79516)
8   179285.25  330301028 POINT (-74.13088 40.60673)
9    52375.10   55186140 POINT (-73.96474 40.80428)
10  342440.71  358667790 POINT (-73.85288 40.67823)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>trees_districts <span class="ot">&lt;-</span> trees_districts <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(  CounDist <span class="sc">&gt;=</span> <span class="dv">1</span>  <span class="sc">&amp;</span> CounDist <span class="sc">&lt;=</span> <span class="dv">10</span> ) <span class="sc">|&gt;</span><span class="co">#only Manhatten</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distance_to_baruch =</span> <span class="fu">st_distance</span>(geom, baruch_college))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>closest_tree <span class="ot">&lt;-</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  trees_districts <span class="sc">|&gt;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by =</span> distance_to_baruch, <span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>closest_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 17 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -73.98339 ymin: 40.73987 xmax: -73.98339 ymax: 40.73987
Geodetic CRS:  WGS 84
  tpcondition stumpdiameter riskratingdate riskrating objectid
1   Excellent          &lt;NA&gt;           &lt;NA&gt;       &lt;NA&gt; 13831280
                              globalid tpstructure
1 A4848157-A343-4882-8F65-47860793F616        Full
                 plantingspaceglobalid         createddate dbh
1 CDA4DC8D-A20D-4E76-8C79-A002C00E5275 2023-05-15 19:02:00   3
          planteddate updateddate                      genusspecies CounDist
1 2023-05-03 04:00:00        &lt;NA&gt; Quercus acutissima - sawtooth oak        2
  Shape_Leng Shape_Area distance_to_baruch                       geom
1   41619.72   48322121       32.59858 [m] POINT (-73.98339 40.73987)</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>What is the species of the tree closest to Baruch‚Äôs campus?</li>
</ol>
<p>The species of the tree closest to Baruch‚Äôs campus is Quercus acutissima - sawtooth oak . # Government Project Design</p>
<p>Task 5: NYC Parks Proposal</p>
</section>
<section id="tree-equity-initiative-greening-district-26-a-proposal-for-10642-new-trees" class="level1">
<h1>Tree Equity Initiative: Greening District 26 ‚Äì A Proposal for 10,642 New Trees</h1>
<p>Prepared for NYC Parks &amp; City Council November 2025</p>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>This proposal outlines the District 26 Tree Equity Initiative, a critical project designed to enhance environmental quality and resident well-being in the neighborhoods of District 26. The primary goal is to address the district‚Äôs severely underdeveloped tree canopy, focusing on areas identified as vulnerable: industrial zones, underutilized open spaces along rail corridors, and exposed waterfronts. The project involves the systematic removal of hazardous stumps, comprehensive planting of new street and park trees, and the establishment of a robust program to ensure the long-term success of the new green infrastructure. Investing in tree canopy is investing in public health, cooling critical heat islands, and improving air quality.</p>
</section>
<section id="the-tree-equity-goal" class="level3">
<h3 class="anchored" data-anchor-id="the-tree-equity-goal">The Tree Equity Goal</h3>
<p>Based on the goal of reaching the average tree density observed across the New York City districts, the scope of this project is set to address the current deficit. The target of 10,642 trees will raise District 26‚Äôs tree count from 15,372 to 26,014, lifting the district‚Äôs density to the current NYC district average of approximately 0.015468 trees per square foot of public space.</p>
</section>
<section id="sub-title-here" class="level3">
<h3 class="anchored" data-anchor-id="sub-title-here">[Sub title here]</h3>
<p>[[map chart here]] The above visualization of District 26 provides highlights two critical areas for tree implementation:</p>
<p>Comparison to the Waterfront Corridors (in dark green): Areas along the East River (Eastside) show high potential for increased density, contrasting with other districts (like District 4 or 5) that have already implemented robust waterfront greening.</p>
<p>Industrial Zones: The southern, former factory zones and areas adjacent to the rail lines present expansive, underutilized opportunities for tree installation to mitigate the heat island effect and buffer residential areas.</p>
<p>District 26 currently holds the dubious distinction of having one of the lowest tree densities among its peers, making it an ideal, high-impact candidate for this federal investment.</p>
</section>
<section id="why-district-26" class="level3">
<h3 class="anchored" data-anchor-id="why-district-26">Why District 26</h3>
<p>[[Missing one non map data visualization ‚Äì to add to a point]]</p>
<p>[show table of lowest 5 tree density] District 26‚Äôs tree density of 0.00914 is significantly below the NYC district average of 0.015468, highlighting a clear need for intervention. Although some districts have lower absolute tree counts, their larger land areas often obscure the urgency of improvement. In contrast, District 26‚Äôs smaller area makes its low density both an urgent and manageable deficit. The accompanying graphic underscores this disparity by visually contrasting District 26‚Äôs density with that of comparable districts and the citywide mean, demonstrating that District 26 not only has the available land area but also represents the most strategic opportunity for investment to advance environmental equity across New York City.</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>This proposal addresses District 26‚Äôs urgent tree canopy deficit, which affects public health and quality of life. The Urban Canopy &amp; Resilience Initiative targets the planting of 10,642 new trees in high-potential areas, providing a data-driven solution to improve environmental equity. We urge the committee to approve this investment for a greener, healthier, and more resilient District 26.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for Task 5 :=&gt; try to find the lowest tree density district</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>lowest_tree_density <span class="ot">&lt;-</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  tree_density <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(<span class="at">order_by=</span> tree_density, <span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>lowest_tree_density</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 4
   CounDist Shape_Area tree_count tree_density
      &lt;int&gt;      &lt;dbl&gt;      &lt;int&gt;        &lt;dbl&gt;
 1       31 507654144.      31318      0.00617
 2       50 665196534.      52439      0.00788
 3       32 358667790.      30261      0.00844
 4       46 277719690.      24304      0.00875
 5       26 168180998.      15372      0.00914
 6       42 201334162.      18934      0.00940
 7       49 330301028.      35027      0.0106 
 8       51 657989092.      70927      0.0108 
 9       38 151771974.      16518      0.0109 
10       13 328361699.      36640      0.0112 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1       31 507654144.      31318      0.00617 &lt;- JFK airport</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#2       50 665196534.      52439      0.00788 &lt;- park included</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#3       32 358667790.      30261      0.00844 &lt;- park included </span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#4       46 277719690.      24304      0.00875 &lt;- park included</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#5       26 168180998.      15372      0.00914 &lt;- area possible for improve**</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tree_density)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    CounDist      Shape_Area          tree_count     tree_density     
 Min.   : 1.0   Min.   : 37752246   Min.   : 8326   Min.   :0.006169  
 1st Qu.:13.5   1st Qu.: 77552173   1st Qu.:13930   1st Qu.:0.013223  
 Median :26.0   Median :115113830   Median :17946   Median :0.015060  
 Mean   :26.0   Mean   :165143965   Mean   :21429   Mean   :0.015468  
 3rd Qu.:38.5   3rd Qu.:180981210   3rd Qu.:24918   3rd Qu.:0.017386  
 Max.   :51.0   Max.   :665196534   Max.   :70927   Max.   :0.028154  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Mean   :0.015468</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#tree need to plan for this district to meet avg green</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 26014.24 (total) - 15372 (current) = 10642 more trees needed</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># formular = 168180998*0.015468/100</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>tree_density <span class="sc">|&gt;</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( CounDist <span class="sc">==</span> <span class="dv">26</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 4
  CounDist Shape_Area tree_count tree_density
     &lt;int&gt;      &lt;dbl&gt;      &lt;int&gt;        &lt;dbl&gt;
1       26 168180998.      15372      0.00914</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#graph </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#compare the tree density vs waterfronts (east/west) </span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#get only graphing district </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>district26 <span class="ot">&lt;-</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>nyc_councildistricts <span class="sc">|&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter (CounDist ==26)</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CounDist <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">26</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#get only trees in district 26</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>trees_districts26 <span class="ot">&lt;-</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  districts_trees <span class="sc">|&gt;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(CounDist == 26) |&gt;</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CounDist <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">26</span>)) <span class="sc">|&gt;</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(objectid) <span class="sc">|&gt;</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co">#drop the join geometry</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(treepoints_sf, <span class="at">by=</span><span class="st">"objectid"</span>)</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(trees_districts26)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   objectid         tpcondition        stumpdiameter     
 Length:15372       Length:15372       Length:15372      
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 riskratingdate                 riskrating          globalid        
 Min.   :2016-06-07 12:09:00   Length:15372       Length:15372      
 1st Qu.:2021-06-07 13:39:24   Class :character   Class :character  
 Median :2022-11-04 14:24:22   Mode  :character   Mode  :character  
 Mean   :2022-10-08 03:36:52                                        
 3rd Qu.:2024-09-23 13:42:02                                        
 Max.   :2025-10-29 14:17:10                                        
 NA's   :6967                                                       
 tpstructure        plantingspaceglobalid  createddate                 
 Length:15372       Length:15372          Min.   :2015-03-10 04:00:00  
 Class :character   Class :character      1st Qu.:2016-01-05 17:21:11  
 Mode  :character   Mode  :character      Median :2016-05-11 20:55:23  
                                          Mean   :2017-07-29 10:54:49  
                                          3rd Qu.:2017-10-12 11:11:11  
                                          Max.   :2025-10-27 19:17:00  
                                                                       
     dbh             planteddate                   updateddate                 
 Length:15372       Min.   :2015-10-09 04:00:00   Min.   :2015-06-08 11:55:00  
 Class :character   1st Qu.:2019-03-25 04:00:00   1st Qu.:2020-02-19 03:48:00  
 Mode  :character   Median :2022-12-15 05:00:00   Median :2022-09-29 15:45:48  
                    Mean   :2022-04-05 19:41:12   Mean   :2022-06-06 12:02:57  
                    3rd Qu.:2024-11-14 05:00:00   3rd Qu.:2024-09-23 15:26:49  
                    Max.   :2025-10-27 04:00:00   Max.   :2025-10-29 14:17:10  
                    NA's   :13683                 NA's   :4009                 
 genusspecies                  geom      
 Length:15372       POINT        :15372  
 Class :character   epsg:4326    :    0  
 Mode  :character   +proj=long...:    0  
                                         
                                         
                                         
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>trees_districts_compare <span class="ot">&lt;-</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  districts_trees <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(CounDist == 26) |&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CounDist <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>)) <span class="sc">|&gt;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(objectid) <span class="sc">|&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span> <span class="co">#drop the join geometry</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(treepoints_sf, <span class="at">by=</span><span class="st">"objectid"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(trees_districts_compare)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   objectid         tpcondition        stumpdiameter     
 Length:19421       Length:19421       Length:19421      
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 riskratingdate                 riskrating          globalid        
 Min.   :2015-10-27 04:00:00   Length:19421       Length:19421      
 1st Qu.:2021-06-10 12:19:46   Class :character   Class :character  
 Median :2022-07-21 14:49:22   Mode  :character   Mode  :character  
 Mean   :2022-10-15 00:30:24                                        
 3rd Qu.:2024-09-04 17:45:23                                        
 Max.   :2025-10-29 16:36:49                                        
 NA's   :5223                                                       
 tpstructure        plantingspaceglobalid  createddate                 
 Length:19421       Length:19421          Min.   :2015-03-04 05:00:00  
 Class :character   Class :character      1st Qu.:2016-01-05 12:34:09  
 Mode  :character   Mode  :character      Median :2016-01-05 14:30:33  
                                          Mean   :2017-03-06 01:46:37  
                                          3rd Qu.:2017-04-20 11:11:11  
                                          Max.   :2025-10-27 12:01:00  
                                                                       
     dbh             planteddate                   updateddate                 
 Length:19421       Min.   :2015-10-21 04:00:00   Min.   :2015-04-26 12:47:00  
 Class :character   1st Qu.:2019-12-12 05:00:00   1st Qu.:2020-02-24 14:55:00  
 Mode  :character   Median :2021-12-10 05:00:00   Median :2022-05-26 23:40:05  
                    Mean   :2021-05-06 04:07:01   Mean   :2022-05-29 15:38:48  
                    3rd Qu.:2023-11-15 05:00:00   3rd Qu.:2024-08-21 17:19:23  
                    Max.   :2025-10-25 04:00:00   Max.   :2025-10-29 16:36:49  
                    NA's   :17554                 NA's   :1841                 
 genusspecies                  geom      
 Length:19421       POINT        :19421  
 Class :character   epsg:4326    :    0  
 Mode  :character   +proj=long...:    0  
                                         
                                         
                                         
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine both tree data frames with a label for legend</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>trees_combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  trees_districts26 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"District 26"</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  trees_districts_compare <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">group =</span> <span class="st">"Districts 4 &amp; 5"</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Map </span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Base map with NYC council districts (polygon layer)</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Council district boundaries</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> district26,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">geometry =</span> geometry),</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"grey95"</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey40"</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.4</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tree points with mapped color (so ggplot knows to make a legend)</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> trees_combined,</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">geometry =</span> geom, <span class="at">color =</span> group),</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span>,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.2</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Color legend setup (defined outside of geom)</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Tree Locations"</span>,</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">"District 26"</span> <span class="ot">=</span> <span class="st">"#B8CD0E"</span>,</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Districts 4 &amp; 5"</span> <span class="ot">=</span> <span class="st">"#2A6417"</span></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="co"># Make legend dots bigger &amp; opaque</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Titles and labels</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Tree Distribution"</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Styling</span></span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp03_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Git4Wing\.github\.io\/STA9750-2025-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>